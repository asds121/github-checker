# 代码提交前检查清单

> **文档说明**：本清单基于《11-多方共识文档》中的质量标准和共识要求制定，用于在每次提交代码前进行系统性的检查，确保代码质量和项目健康度。
>
> **使用方法**：在提交代码前，逐项检查以下内容，确保所有"必须"项都已满足。对于"建议"项，应根据实际情况评估是否需要满足。

---

## 一、代码质量检查

### 1.1 代码风格 ✅ 必须项

- [ ] **PEP 8规范**：代码遵循PEP 8规范，无flake8检查错误
- [ ] **命名规范**：
  - [ ] 类名使用大驼峰（如 `Checker`）
  - [ ] 方法名和变量名使用小写下划线（如 `check`、`cursor_position`）
  - [ ] 常量使用全大写（如 `TARGETS`）
- [ ] **代码结构**：函数和类的职责单一，避免过长的函数和过大的类
- [ ] **代码可读性**：逻辑清晰直接，变量和函数的命名能准确表达其用途

### 1.2 代码注释 ✅ 必须项

- [ ] **关键逻辑注释**：关键逻辑处必须有注释说明
- [ ] **复杂算法注释**：复杂算法应有步骤说明
- [ ] **设计决策注释**：重要的设计决策应有上下文说明
- [ ] **避免无意义注释**：避免"这是注释"等无意义的注释

### 1.3 错误处理 ✅ 必须项

- [ ] **异常覆盖**：所有可能抛出异常的代码路径都有异常处理
- [ ] **异常信息**：异常信息应具体明确，便于定位问题
- [ ] **用户提示**：用户可见的错误提示应友好且具有可操作性
- [ ] **优雅降级**：异常情况下程序应优雅处理，不应出现程序崩溃

### 1.4 代码审查 ✅ 必须项（v1.2.0新增）

- [ ] **重要功能审查**：重要功能变更应经过代码审查或自我复审
- [ ] **审查清单**：使用代码审查清单，确保审查质量
- [ ] **设计决策**：重要的设计决策应有上下文说明和审查记录
- [ ] **性能影响**：评估代码变更对性能的影响，避免性能退化
- [ ] **安全审查**：如涉及安全相关变更，进行安全审查
- [ ] **代码符合设计**：代码实现是否符合原始设计要求
- [ ] **潜在问题识别**：代码中是否有潜在问题或改进建议
- [ ] **阻塞性问题**：是否有阻塞性问题需要立即修复

### 1.5 需求明确性 ✅ 必须项（v1.2.0新增）

- [ ] **需求文档更新**：需求文档已更新并经过评审
- [ ] **需求变更记录**：需求变更已记录并通知相关方
- [ ] **需求优先级**：需求优先级已明确
- [ ] **验收标准**：验收标准清晰可量化
- [ ] **技术方案评审**：技术方案经过评审，架构设计合理
- [ ] **接口设计**：接口设计清晰，性能考虑充分

---

## 二、功能质量检查

### 2.1 功能正确性 ✅ 必须项

- [ ] **检测结果准确**：网络状态检测结果准确反映实际的GitHub可访问性状态
- [ ] **状态判断正确**：状态判断逻辑正确，阈值设定合理
- [ ] **场景覆盖**：检测逻辑覆盖各种网络场景（正常、波动、中断等）

### 2.2 功能完整性 ✅ 必须项

- [ ] **功能完整**：所有声明的功能都应完整实现并可用
- [ ] **功能边界清晰**：功能边界应清晰定义，避免功能缺失或功能越界
- [ ] **功能协调**：功能之间的交互应一致协调，不应出现功能冲突

### 2.3 回归预防 ✅ 必须项

- [ ] **已有功能测试**：运行现有测试套件，确保代码变更不破坏已有功能
- [ ] **手动验证**：重要功能变更应经过手动验证后再提交
- [ ] **边界测试**：测试边界条件和异常场景

### 2.4 测试用例评审 ✅ 必须项（v1.2.0新增）

- [ ] **测试用例覆盖**：测试用例覆盖所有功能点和边界条件
- [ ] **测试独立性**：每个测试用例独立运行，无依赖关系
- [ ] **测试数据合理**：测试数据合理，能有效验证功能
- [ ] **断言完整**：测试用例包含完整的断言，验证预期结果
- [ ] **Mock使用**：外部依赖使用Mock，便于单元测试
- [ ] **测试可读性**：测试代码清晰，便于理解和维护

### 2.5 设计符合性 ✅ 必须项（v1.2.0新增）

- [ ] **架构一致性**：代码实现符合项目整体架构设计
- [ ] **模块边界**：代码模块边界清晰，职责分明
- [ ] **接口一致性**：新功能接口与现有接口风格一致
- [ ] **设计模式**：如适用，使用恰当的设计模式
- [ ] **技术债务**：避免引入不必要的技术债务
- [ ] **扩展性考虑**：设计考虑未来扩展性

---

## 三、测试覆盖检查

### 3.1 单元测试 ✅ 必须项

- [ ] **核心功能测试**：核心功能（Checker类的方法）有对应的单元测试
- [ ] **测试覆盖率**：核心功能测试覆盖率达到80%以上
- [ ] **整体覆盖率**：整体项目代码覆盖率达到60%以上
- [ ] **关键路径**：关键路径（快速测试完整流程）覆盖率达到100%
- [ ] **边界条件测试**：边界条件已被测试（空输入、超长输入、特殊字符等）
- [ ] **异常场景测试**：异常场景已被测试（网络超时、API错误等）

### 3.2 测试质量

- [ ] **测试用例独立**：每个测试用例独立运行，无依赖关系
- [ ] **测试确定性**：测试结果确定，无随机性
- [ ] **测试可维护**：测试代码结构清晰，易于维护
- [ ] **测试数据合理**：测试数据合理，能有效验证功能
- [ ] **预期结果清晰**：测试用例应有清晰的预期结果
- [ ] **测试代码质量**：测试代码本身应保持良好的可读性
- [ ] **Mock使用**：外部依赖应可通过Mock替换，便于单元测试

### 3.3 Mock使用

- [ ] **Mock对象合理**：Mock对象设计合理，符合实际使用场景
- [ ] **Mock值充分**：Mock值充分，避免StopIteration等异常
- [ ] **Mock反映真实**：Mock能够反映真实场景，数据有意义
- [ ] **避免过度Mock**：避免过度使用Mock，保持测试的真实性
- [ ] **测试通过**：所有测试用例都能通过
- [ ] **无跳过测试**：无跳过或忽略的测试用例（除非有明确说明）
- [ ] **测试独立**：测试用例之间相互独立，无依赖关系

---

## 四、文档更新检查

### 4.1 项目文档 ✅ 必须项

- [ ] **README更新**：README.md反映了最新版本的功能和用法
- [ ] **功能说明**：README包含项目简介、功能说明、安装方法、使用示例
- [ ] **常见问题**：README包含常见问题解答（如有新增问题）
- [ ] **CHANGELOG更新**：CHANGELOG.md记录了本次变更的内容

### 4.2 代码文档 ✅ 必须项

- [ ] **注释同步**：代码注释与代码实现同步更新
- [ ] **文档一致性**：相关设计文档（01-03）与实际代码保持一致
- [ ] **实现状态标注**：如有未实现功能，在文档中明确标注

### 4.3 API文档 ⚠️ 建议项

- [ ] **API文档更新**：如有API变更，更新相关API文档
- [ ] **参数说明**：新增或修改的参数有清晰的说明
- [ ] **返回值说明**：新增或修改的返回值有清晰的说明

---

## 五、技术选型检查

### 5.1 依赖管理 ✅ 必须项

- [ ] **标准库优先**：优先使用Python标准库实现功能
- [ ] **依赖最小化**：严格控制外部依赖的数量和版本
- [ ] **依赖评估**：引入外部依赖前已评估维护成本、兼容性和安全性
- [ ] **依赖更新**：requirements.txt已更新（如有依赖变更）

### 5.2 兼容性检查 ✅ 必须项

- [ ] **跨平台兼容**：代码能够在Windows、macOS和Linux上正常运行
- [ ] **Python版本**：代码兼容目标Python版本
- [ ] **平台测试**：如有可能，在多个平台上进行测试验证

### 5.3 安全性检查 ✅ 必须项

- [ ] **输入验证**：用户输入经过验证和清理，防范注入攻击
- [ ] **敏感信息**：敏感信息（如API密钥）未硬编码在代码中
- [ ] **安全协议**：网络请求使用安全的协议和配置

---

## 六、提交信息检查

### 6.1 提交消息 ✅ 必须项

- [ ] **消息清晰**：提交消息清晰描述了本次变更的内容
- [ ] **关联Issue**：如相关，提交消息中关联了对应的Issue编号
- [ ] **遵循规范**：提交消息遵循项目的提交消息规范

### 6.2 变更范围 ✅ 必须项

- [ ] **变更范围合理**：提交的变更范围合理，避免过大的提交
- [ ] **文件整理**：不包含调试代码、临时文件或无关文件
- [ ] **代码格式化**：代码已格式化，无多余的空格或换行

---

## 七、CI/CD检查

### 7.1 静态检查 ✅ 必须项

- [ ] **flake8检查**：flake8静态检查通过，无错误和警告
  - **重要**：即使本地未安装flake8，也必须确保代码符合flake8规范
  - **检查方法**：在提交前，查看GitHub Actions的CI检查结果
  - **常见错误**：
    - E131: 悬挂缩进的对齐问题
    - E203: 冒号前的空格（已忽略）
    - W503: 二元运算符前换行（已忽略）
  - **配置参数**：`--max-line-length=120 --ignore=E203,W503`
- [ ] **代码风格**：代码风格符合项目规范
- [ ] **缩进对齐**：多行语句的缩进必须正确对齐（特别注意E131错误）

### 7.2 自动化测试 ✅ 必须项（v1.2.0新增）

- [ ] **CI测试通过**：GitHub Actions或其他CI工具的测试通过
- [ ] **测试报告**：查看测试报告，确认覆盖率达标
- [ ] **本地测试**：提交前在本地运行测试，确保所有测试通过
- [ ] **自动化流程**：测试已集成到CI/CD流程，在代码提交时自动运行
- [ ] **覆盖率监控**：测试覆盖率低于目标不应发布（核心80%+，整体60%+）
- [ ] **回归检测**：自动化测试能够检测代码变更是否引入回归问题

### 7.3 构建检查 ⚠️ 建议项

- [ ] **构建成功**：项目能够成功构建
- [ ] **部署测试**：如适用，进行了部署测试

---

## 八、特殊场景检查

### 8.1 破坏性变更 ⚠️ 建议项

- [ ] **变更说明**：如有破坏性变更，在提交消息中明确说明
- [ ] **迁移指南**：如需要，提供迁移指南或升级说明
- [ ] **版本更新**：考虑是否需要更新版本号

### 8.2 性能变更 ⚠️ 建议项

- [ ] **性能测试**：如涉及性能变更，进行了性能测试
- [ ] **性能基准**：与性能基准对比，确认无性能退化
- [ ] **优化说明**：如有性能优化，在提交消息中说明

### 8.3 安全变更 ⚠️ 建议项

- [ ] **安全审查**：如涉及安全相关变更，进行了安全审查
- [ ] **漏洞修复**：如修复安全漏洞，在CHANGELOG中明确说明
- [ ] **安全公告**：如需要，发布安全公告

---

## 九、最终确认

### 9.1 自我审查 ✅ 必须项

- [ ] **代码审查**：已对代码进行自我审查，确认功能正确性和代码质量
- [ ] **测试验证**：已充分测试，确认变更符合预期
- [ ] **文档检查**：已检查相关文档，确认文档与代码一致

### 9.2 准备提交 ✅ 必须项

- [ ] **清单完成**：本清单的所有"必须"项都已满足
- [ ] **建议项评估**：已评估"建议"项，根据实际情况决定是否满足
- [ ] **准备就绪**：确认代码已准备好提交

---

## 十、用户反馈收集检查 ⚠️ 建议项（v1.2.0新增）

### 10.1 反馈收集 ✅ 建议项

- [ ] **反馈渠道**：建立用户反馈收集机制（GitHub Issues、用户调研、社区互动）
- [ ] **反馈分析**：定期评估用户反馈，识别需要改进的功能
- [ ] **需求分析**：建立用户需求分析机制，识别需求变化的趋势和规律
- [ ] **响应及时性**：Issue响应时间应控制在合理范围内（严重问题24小时内，一般问题72小时内）

### 10.2 反馈应用 ✅ 建议项

- [ ] **功能改进**：根据用户反馈改进产品功能
- [ ] **体验优化**：根据用户反馈优化用户体验
- [ ] **文档完善**：根据用户反馈完善文档内容
- [ ] **优先级调整**：根据用户反馈调整任务优先级

---

## 附录：快速检查清单（简化版）

### 提交前必做事项

- [ ] 运行 `python check_dev_workflow.py` 执行自动化工作流程检查（推荐）
  - 该脚本会自动检查代码规范、测试验证、模块导入、项目结构、文档检查和Git状态
  - 确保所有6项检查都通过后再提交
- [ ] 运行 `flake8` 检查代码风格
- [ ] 运行 `python -m pytest tests/` 执行测试
- [ ] 检查测试覆盖率是否达标（核心80%+，整体60%+）
- [ ] 更新 README.md 和 CHANGELOG.md
- [ ] 确认代码注释完整
- [ ] 验证核心功能正常工作
- [ ] 检查错误处理是否完善
- [ ] 确认无敏感信息泄露
- [ ] 编写清晰的提交消息

### 提交前建议事项

- [ ] 在多个平台上测试
- [ ] 进行性能测试（如有性能变更）
- [ ] 进行安全审查（如有安全变更）
- [ ] 评估破坏性变更影响
- [ ] 更新相关设计文档

---

## 参考文档

- **11-多方共识文档.md**：本清单的主要依据
- **02-系统设计.md**：系统架构和设计规范
- **03-详细设计.md**：详细设计规范
- **README.md**：项目使用说明
- **CHANGELOG.md**：版本变更记录

---

## 版本历史

- **v1.0.0** (2024-12-23)：初始版本，基于多方共识文档创建
