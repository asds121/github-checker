# 用户使用指南和故障排查

**文档版本**：v1.2.0
**创建日期**：2024-12-24
**最后更新**：2025-01-25
**适用版本**：GitHub Checker v1.3.0+
**更新说明**：更新文档版本信息以匹配v1.3.0，添加v1.3.0版本变更说明

---

## v1.1.0 版本功能实现情况

基于对cli.py代码（v1.1.0）的分析，以下为v1.1.0版本的功能实现情况对照：

### 已实现功能（✓）

#### P0 优先级（核心功能）

- ✓ 单次网络检测功能（check方法和相关逻辑）
- ✓ 状态判断功能（judge方法及相关阈值逻辑，阈值3000ms）
- ✓ 命令行参数解析功能（argparse配置和-h/-n/-f/-j参数处理）
- ✓ 错误处理功能（网络异常的捕获和提示）

#### P1 优先级（重要辅助功能）

- ✓ 完整测试功能（test方法及平均值计算逻辑）
- ✓ 动画反馈功能（spinning_cursor生成器和集成）
- ✓ 状态消息功能（msg方法生成用户友好描述）
- ✓ 错误提示优化（具体的错误原因和解决建议）

#### P2 优先级（增强功能）

- ✓ JSON输出格式支持（-j/--json参数）
- ✓ 详细程度选项（-f/--full-test参数）

#### 额外实现功能

- ✓ Windows ANSI颜色支持（通过colorama库实现跨平台颜色输出）
- ✓ 详细错误处理（try-except捕获网络异常、连接超时等）
- ✓ 多次检测统计（-n参数执行3次检测并计算平均值）

### 待改进功能（✗）

#### P2 优先级（部分实现）

- ✗ 自定义检测目标配置（当前仅支持GitHub，未实现自定义配置）
- ✗ 进度百分比显示（当前仅有动画效果，无百分比显示）
- ✗ 阶段性检测提示（当前仅有完成提示，无阶段性提示）

#### P3 优先级（未实现）

- ✗ 交互式操作模式
- ✗ 批量检测目标管理
- ✗ 历史数据存储与分析
- ✗ 与其他工具的集成

---

## 📖 目录

1. [快速开始](#快速开始)
2. [安装指南](#安装指南)
3. [使用说明](#使用说明)
4. [命令行参数](#命令行参数)
5. [输出解读](#输出解读)
6. [常见问题](#常见问题)
7. [故障排查](#故障排查)
8. [最佳实践](#最佳实践)
9. [高级用法](#高级用法)

---

## 🚀 快速开始

### 最简单的使用方式

```bash
# Windows用户
start.bat

# Linux/Mac用户
python3 cli.py
```

这将执行快速测试模式，检测GitHub的连接状态。

### 完整测试模式

```bash
# Windows用户
start-full.bat

# 或使用命令行参数
python3 cli.py --full-test
```

这将执行3轮完整测试，提供详细的统计信息。

---

## 📦 安装指南

### 系统要求

- **Python版本**：Python 3.6 或更高版本
- **操作系统**：Windows、Linux、macOS
- **网络**：需要访问互联网（用于检测GitHub连接）

### 安装步骤

#### 1. 克隆或下载项目

```bash
git clone https://github.com/asds121/github-checker.git
cd github-checker
```

#### 2. 安装依赖

```bash
pip install -r requirements.txt
```

主要依赖：

- `requests`：用于HTTP请求
- `pytest`：用于运行测试（开发时需要）

#### 3. 验证安装

```bash
python3 cli.py
```

如果看到输出结果，说明安装成功。

### Windows用户特别说明

Windows用户可以直接双击运行：

- `start.bat`：快速测试模式
- `start-full.bat`：完整测试模式

---

## 📝 使用说明

### 基础使用

#### 快速测试模式

快速测试模式执行单轮检测，适合快速检查网络状态：

```bash
python3 cli.py
```

**输出示例**：

```
GitHub Network Status Checker v1.2.0
========================================
Checking GitHub accessibility... ✓

Results:
----------------------------------------
  homepage :  OK  (245ms)
  api      :  OK  (312ms)
----------------------------------------
[OK] GitHub is accessible (avg 279ms)

Network is stable, you can push code normally.
```

#### 完整测试模式

完整测试模式执行多轮检测，提供更详细的统计信息：

```bash
python3 cli.py --full-test
```

**输出示例**：

```
GitHub Network Status Checker v1.2.0
========================================
Checking GitHub accessibility...

Running full test (3 iterations)...
  Iteration 1/3 (33%)...
  Iteration 2/3 (67%)...
  Iteration 3/3 (100%)...

Results:
----------------------------------------
Full test completed (3 iterations)
Successful checks: 3/3
Average total time: 278ms

Target statistics:
  homepage  : Avg 245ms, Success rate: 100.0%
  api       : Avg 312ms, Success rate: 100.0%
----------------------------------------
[OK] GitHub is accessible (avg 279ms)

Network is stable, you can push code normally.
```

### JSON输出模式

支持JSON格式输出，便于脚本处理：

```bash
python3 cli.py --json
```

**输出示例**：

```json
{
  "version": "v1.2.0",
  "timestamp": "2024-12-24 10:30:45",
  "status": "good",
  "message": "GitHub is accessible (avg 279ms)",
  "is_full_test": false,
  "results": [
    {
      "target": "homepage",
      "status": "OK",
      "response_time_ms": 245.0,
      "error": null
    },
    {
      "target": "api",
      "status": "OK",
      "response_time_ms": 312.0,
      "error": null
    }
  ],
  "suggestion": "Network is stable, you can push code normally."
}
```

完整测试模式的JSON输出：

```bash
python3 cli.py --full-test --json
```

**输出示例**：

```json
{
  "version": "v1.2.0",
  "timestamp": "2024-12-24 10:30:45",
  "status": "good",
  "message": "GitHub is accessible (avg 279ms)",
  "is_full_test": true,
  "iterations": 3,
  "successful_checks": 3,
  "avg_total_time_ms": 278.0,
  "target_stats": {
    "homepage": {
      "avg_response_ms": 245.0,
      "success_rate": 100.0
    },
    "api": {
      "avg_response_ms": 312.0,
      "success_rate": 100.0
    }
  },
  "suggestion": "Network is stable, you can push code normally."
}
```

---

## ⚙️ 命令行参数

### 参数列表

| 参数          | 简写 | 说明                                      | 示例                    |
| ------------- | ---- | ----------------------------------------- | ----------------------- |
| `--full-test` | `-f` | 执行完整测试模式（3轮检测）               | `python3 cli.py -f`     |
| `--json`      | `-j` | 以JSON格式输出结果                        | `python3 cli.py -j`     |
| `--theme`     | `-t` | 选择输出主题（default/minimal/fun/share） | `python3 cli.py -t fun` |
| `--share`     | `-s` | 生成简洁分享文案                          | `python3 cli.py -s`     |
| `--intro`     | `-i` | 显示工具价值介绍                          | `python3 cli.py -i`     |
| `--quiet`     | `-q` | 安静模式（最小输出）                      | `python3 cli.py -q`     |
| `--help`      | `-h` | 显示帮助信息                              | `python3 cli.py -h`     |

### 参数组合使用

可以组合使用多个参数：

```bash
# 完整测试模式 + JSON输出
python3 cli.py --full-test --json

# 或使用简写
python3 cli.py -f -j

# 使用有趣主题输出
python3 cli.py -t fun

# 生成简洁分享文案
python3 cli.py --share

# 安静模式（最小输出）
python3 cli.py --quiet

# 显示工具价值介绍
python3 cli.py --intro
```

---

## 输出主题

### 主题类型

程序支持4种输出主题，您可以根据使用场景选择合适的格式：

| 主题名称  | 简写         | 说明                     | 适用场景             |
| --------- | ------------ | ------------------------ | -------------------- |
| `default` | `-t default` | 标准输出，包含详细信息   | 日常使用、问题排查   |
| `minimal` | `-t minimal` | 紧凑格式，仅显示关键信息 | 快速检查、脚本处理   |
| `fun`     | `-t fun`     | 有趣风格，幽默状态描述   | 分享给朋友、社交媒体 |
| `share`   | `-t share`   | 专为截图优化的格式       | 截图分享、文档记录   |

### 主题使用示例

#### default主题（默认）

```bash
python3 cli.py
```

**输出示例**：

```
==================================================
  DETECTION RESULTS
--------------------
  homepage  : OK     (245ms)
  api       : OK     (312ms)

==================================================
STATUS: [OK] GitHub is accessible (avg 279ms)

==================================================
SUGGESTION
  Network is stable, you can push code normally.

==================================================
SHARE THIS RESULT
GitHub Checker v1.2.0 | GitHub is accessible (avg 279ms) | 2024-12-24 10:30:45
```

#### minimal主题（紧凑）

```bash
python3 cli.py -t minimal
```

**输出示例**：

```
homepage: OK (245ms)
api: OK (312ms)
STATUS: OK (GitHub is accessible (avg 279ms))
```

#### fun主题（有趣）

```bash
python3 cli.py -t fun
```

**输出示例**：

```
==================================================
[OK] DETECTION RESULTS [OK]
--------------------
  homepage  : OK     (245ms) [PASS]
  api       : OK     (312ms) [PASS]

==================================================
STATUS: GitHub is super fast! Everything is blazing!

==================================================
SUGGESTION
  You can push code now! Go for it!

==================================================
SHARE THIS RESULT
GitHub Checker v1.2.0 | GitHub is accessible (avg 279ms) | 2024-12-24 10:30:45
```

#### share主题（截图优化）

```bash
python3 cli.py -t share
```

**输出示例**：

```
------------------------------
  GitHub Status Check
------------------------------

  [OK] Excellent

  Target      Status  Time
  ------------ -------- --------
  homepage     OK       245ms [FAST]
  api          OK       312ms

  ------------------------------
  via GitHub Checker • 12/24 10:30
```

---

## 使用场景示例

### 场景1：日常开发前快速检查

在开始一天的开发工作前，快速确认GitHub连接状态：

```bash
# 快速检查（安静模式）
python3 cli.py --quiet

# 或使用紧凑主题
python3 cli.py -t minimal
```

**预期输出**：简洁的OK/FAIL状态提示，1秒内完成检查。

### 场景2：向团队报告网络状态

当团队成员遇到GitHub连接问题时，生成截图分享给团队：

```bash
# 使用截图优化主题
python3 cli.py -t share

# 或生成简洁分享文案
python3 cli.py --share
```

**预期输出**：格式美观的截图-ready输出，或便于粘贴的简洁文本。

### 场景3：网络问题诊断

当遇到git操作失败时，进行详细诊断：

```bash
# 完整测试模式 + 默认主题
python3 cli.py --full-test

# 获取JSON格式用于进一步分析
python3 cli.py --full-test --json
```

**预期输出**：3轮检测的详细统计信息，包括每个目标的平均响应时间和成功率。

### 场景4：分享到社交媒体或Issue

当需要在Issue评论或社交媒体分享GitHub状态时：

```bash
# 生成简洁分享文案
python3 cli.py --share

# 或使用有趣主题后截图
python3 cli.py -t fun
```

**分享文案示例**：

```
[OK] GitHub Status: 2/2 targets OK | [TIME] Avg response: 279ms
```

### 场景5：了解工具价值

首次使用或向他人介绍工具时：

```bash
# 显示工具价值介绍
python3 cli.py --intro
```

**预期输出**：

```
==================================================
GitHub Network Status Checker - Solve Your GitHub Connection Anxiety
==================================================
Core Value:
  * Quickly detect GitHub accessibility, avoid wasted operations
  * Provide response time reference, optimize your workflow
  * Give specific suggestions, reduce troubleshooting time
==================================================
```

---

## 最佳实践

### 开发工作流集成

建议在以下场景使用GitHub Checker：

1. **每日开始工作前**：运行快速检查，确认网络状态
2. **执行git操作前**：确认可以正常访问GitHub
3. **遇到连接问题时**：运行完整测试模式进行诊断
4. **报告问题时**：使用截图主题生成状态报告

### 脚本自动化

可以将GitHub Checker集成到CI/CD流程中：

```bash
# 在脚本中检查GitHub状态
python3 cli.py --json > status.json

# 检查状态是否为good
python3 -c "import json; data = json.load(open('status.json')); exit(0 if data['status'] == 'good' else 1)"
```

### 结果存档

使用JSON输出模式保存检测结果：

```bash
# 保存每次检测结果
python3 cli.py --full-test --json > reports/status_$(date +%Y%m%d_%H%M%S).json
```

---

## 📊 输出解读

### 状态标识

程序使用三种状态标识：

| 标识     | 颜色 | 含义                               | 建议操作                     |
| -------- | ---- | ---------------------------------- | ---------------------------- |
| `[OK]`   | 绿色 | 网络连接正常，响应速度快           | 可以正常进行git操作          |
| `[WARN]` | 黄色 | 网络连接正常但较慢，或部分目标失败 | 可以继续操作，但建议稍后再试 |
| `[FAIL]` | 红色 | 网络连接失败                       | 检查网络连接，稍后重试       |

### 响应时间阈值

- **快速响应**：< 3000ms（3秒）→ `[OK]` 状态
- **慢速响应**：≥ 3000ms（3秒）→ `[WARN]` 状态

### 检测目标

程序检测以下GitHub服务：

| 目标名称   | URL                    | 说明       |
| ---------- | ---------------------- | ---------- |
| `homepage` | https://github.com     | GitHub主页 |
| `api`      | https://api.github.com | GitHub API |

### 完整测试模式统计

完整测试模式提供以下统计信息：

- **迭代次数**：执行的检测轮数（固定为3轮）
- **成功检查数**：成功的检测轮数
- **平均总时间**：所有轮次的平均总耗时
- **目标统计**：每个目标的平均响应时间和成功率

---

## ❓ 常见问题

### Q1: 为什么检测到网络不稳定？

**A:** 可能的原因：

- 网络连接不稳定
- GitHub服务器响应慢
- 防火墙或代理设置问题
- DNS解析问题

**建议**：

- 检查本地网络连接
- 尝试访问 https://github.com 确认是否可以访问
- 使用完整测试模式获取更详细的信息

### Q2: 如何提高检测准确性？

**A:** 建议使用完整测试模式：

```bash
python3 cli.py --full-test
```

完整测试模式执行3轮检测，提供更准确的统计信息。

### Q3: 检测结果与实际体验不符？

**A:** 可能的原因：

- 检测时的网络状况与实际使用时不同
- 检测目标与实际使用的GitHub服务不同
- 网络波动

**建议**：

- 多次运行检测，观察结果一致性
- 使用完整测试模式获取平均数据
- 结合实际git操作体验判断

### Q4: 可以检测其他Git服务吗？

**A:** 当前版本仅支持GitHub检测。未来版本可能支持：

- GitLab
- Gitee
- 自建Git服务器

### Q5: 如何在脚本中使用？

**A:** 使用JSON输出模式：

```bash
python3 cli.py --json > result.json
```

然后在脚本中解析JSON结果：

```python
import json
import subprocess

result = subprocess.run(['python3', 'cli.py', '--json'],
                       capture_output=True, text=True)
data = json.loads(result.stdout)

if data['status'] == 'good':
    print("网络正常，可以执行git操作")
else:
    print("网络异常，请检查连接")
```

### Q6: Windows下双击bat文件没反应？

**A:** 可能的原因：

- Python未安装或未添加到PATH
- 依赖包未安装

**解决方法**：

1. 确认Python已安装：在命令行输入 `python --version`
2. 安装依赖：`pip install -r requirements.txt`
3. 在命令行中运行bat文件，查看错误信息

---

## 🔧 故障排查

### 问题1：安装依赖失败

**错误信息**：

```
ERROR: Could not find a version that satisfies the requirement requests
```

**解决方法**：

```bash
# 升级pip
pip install --upgrade pip

# 使用国内镜像源
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 问题2：运行时提示模块未找到

**错误信息**：

```
ModuleNotFoundError: No module named 'requests'
```

**解决方法**：

```bash
pip install requests
```

### 问题3：网络连接超时

**错误信息**：

```
[FAIL] Cannot connect to GitHub (homepage)
```

**排查步骤**：

1. **检查网络连接**

   ```bash
   # Windows
   ping github.com

   # Linux/Mac
   ping -c 4 github.com
   ```

2. **检查防火墙设置**
   - 确认防火墙允许Python程序访问网络
   - 检查是否有代理设置

3. **检查DNS解析**

   ```bash
   # Windows
   nslookup github.com

   # Linux/Mac
   dig github.com
   ```

4. **使用浏览器访问**
   - 打开浏览器访问 https://github.com
   - 确认是否可以正常访问

### 问题4：JSON输出乱码

**错误信息**：JSON输出中包含乱码字符

**解决方法**：

```bash
# Windows PowerShell
$env:PYTHONIOENCODING="utf-8"
python3 cli.py --json

# Linux/Mac
PYTHONIOENCODING=utf-8 python3 cli.py --json
```

### 问题5：颜色显示异常

**问题**：终端中颜色显示不正常或显示乱码

**解决方法**：

- 使用支持ANSI颜色的终端（如Windows Terminal、Git Bash）
- 或使用JSON输出模式避免颜色问题：
  ```bash
  python3 cli.py --json
  ```

```

### 问题6：权限错误

**错误信息**：

```

PermissionError: [Errno 13] Permission denied

````

**解决方法**：

```bash
# Linux/Mac
chmod +x cli.py

# Windows：以管理员身份运行命令行
````

### 问题7：检测速度很慢

**可能原因**：

- 网络连接慢
- GitHub服务器响应慢
- 防火墙或代理延迟

**解决方法**：

1. 检查网络速度
2. 尝试更换网络环境
3. 使用完整测试模式获取详细统计信息

---

## 💡 最佳实践

### 1. 定期检测网络状态

建议在执行git操作前检测网络状态：

```bash
# 快速检测
python3 cli.py

# 如果网络正常，再执行git操作
if [ $? -eq 0 ]; then
    git push
fi
```

### 2. 使用完整测试模式进行网络诊断

当遇到网络问题时，使用完整测试模式：

```bash
python3 cli.py --full-test
```

这样可以获得更详细的统计信息，帮助诊断问题。

### 3. 集成到CI/CD流程

在CI/CD流程中集成检测：

```yaml
# GitHub Actions示例
- name: Check GitHub connectivity
  run: |
    python3 cli.py --json > connectivity.json
    cat connectivity.json
```

### 4. 保存检测历史

定期保存检测结果，用于网络质量分析：

```bash
# 保存检测结果
python3 cli.py --json >> connectivity_history.log

# 分析历史数据
grep -o '"status":"[^"]*"' connectivity_history.log | sort | uniq -c
```

### 5. 设置网络检测提醒

创建定时任务，定期检测网络：

**Windows任务计划程序**：

```bat
@echo off
python3 cli.py --full-test --json > C:\logs\connectivity.log
```

**Linux crontab**：

```bash
# 每小时检测一次
0 * * * * /usr/bin/python3 /path/to/cli.py --full-test --json >> /var/log/connectivity.log
```

### 6. 开发者最佳实践（代码提交前检查）

作为开发者，在提交代码前应使用自动化工作流程检查脚本：

```bash
# 运行开发工作流程检查
python3 check_dev_workflow.py
```

该脚本会自动检查以下6项内容：

1. **代码规范检查**：使用Flake8检查代码风格
2. **测试验证**：运行单元测试确保功能正常
3. **模块导入检查**：验证核心模块可以正常导入
4. **项目结构检查**：确认必要的文件和目录存在
5. **文档检查**：验证README.md和CHANGELOG.md已更新
6. **Git状态检查**：确认没有未提交的更改

**检查结果示例**：

```
========================================
开发工作流程检查
========================================

[✓] 代码规范检查通过
[✓] 测试验证通过
[✓] 模块导入检查通过
[✓] 项目结构检查通过
[✓] 文档检查通过
[✓] Git状态检查通过

========================================
所有检查通过！可以安全提交代码。
========================================
```

**注意事项**：

- Windows系统下，脚本会自动使用GBK编码读取文件，避免编码错误
- 如果某项检查失败，请根据提示修复问题后再提交
- 建议每次提交代码前都运行此检查，确保代码质量

---

## 🎯 高级用法

### 1. 作为Python模块使用

可以在Python代码中直接使用Checker类：

```python
from core.checker import Checker

# 创建检测器实例
checker = Checker()

# 执行快速检测
result = checker.check(timeout=8.0)
print(f"状态: {result['status']}")
print(f"消息: {result['msg']}")

# 执行完整测试
full_result = checker.test(timeout=8.0)
print(f"迭代次数: {full_result['iterations']}")
print(f"平均时间: {full_result['avg_total_time']:.0f}ms")
```

### 2. 自定义超时时间

```python
from core.checker import Checker

checker = Checker()

# 使用自定义超时时间（10秒）
result = checker.check(timeout=10.0)
```

### 3. 解析检测结果

```python
from core.checker import Checker
import json

checker = Checker()
result = checker.check()

# 检查每个目标的状态
for name, data in result['results']:
    if data['ok']:
        print(f"{name}: 正常 ({data['ms']}ms)")
    else:
        print(f"{name}: 失败 ({data.get('error', '未知错误')})")
```

### 4. 创建自定义检测脚本

```python
#!/usr/bin/env python3
from core.checker import Checker
import time

def continuous_check(interval=60):
    """持续检测网络状态"""
    checker = Checker()

    while True:
        result = checker.check()
        timestamp = time.strftime("%Y-%m-%d %H:%M:%S")

        print(f"[{timestamp}] 状态: {result['status']}")
        print(f"[{timestamp}] 消息: {result['msg']}")

        if result['status'] != 'good':
            # 发送通知（可以集成邮件、短信等）
            print(f"[{timestamp}] 警告：网络状态异常！")

        time.sleep(interval)

if __name__ == '__main__':
    continuous_check(interval=300)  # 每5分钟检测一次
```

### 5. 与git操作集成

```bash
#!/bin/bash
# git-push-safe.sh - 安全的git推送脚本

echo "检测GitHub连接状态..."
python3 cli.py --json > /tmp/github_status.json

STATUS=$(grep -o '"status":"[^"]*"' /tmp/github_status.json | cut -d'"' -f4)

if [ "$STATUS" = "good" ]; then
    echo "网络正常，开始推送..."
    git push
else
    echo "网络异常，取消推送"
    echo "请稍后重试或检查网络连接"
    exit 1
fi
```

---

## 📞 获取帮助

### 文档资源

- **README.md**：项目概述和基本使用说明
- **CHANGELOG.md**：版本更新历史
- **docs/**：完整的技术文档

### 问题反馈

如果遇到问题或有建议，请通过以下方式反馈：

- **GitHub Issues**：https://github.com/asds121/github-checker/issues
- **提交Bug报告**：请包含详细的错误信息和复现步骤
- **功能建议**：欢迎提出改进建议

### 社区支持

- 查看[GitHub Discussions](https://github.com/asds121/github-checker/discussions)
- 搜索已有的Issue，可能已有解决方案

---

## 📝 更新日志

| 版本 | 日期       | 更新内容                       |
| ---- | ---------- | ------------------------------ |
| v1.0 | 2024-12-24 | 创建用户使用指南和故障排查文档 |

---

**文档结束**
