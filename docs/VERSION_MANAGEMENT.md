# 版本管理策略

## 文档信息

| 项目     | 值           |
| -------- | ------------ |
| 文档版本 | v1.0.0       |
| 创建日期 | 2025-01-26   |
| 最后更新 | 2025-01-26   |
| 作者     | 项目开发团队 |
| 状态     | 已发布       |

---

## 1. 概述

### 1.1 文档目的

本文档定义GitHub Status Checker项目的版本管理策略，包括版本号规范、发布流程和版本维护。

### 1.2 适用范围

适用于所有参与项目开发、测试和发布的团队成员。

### 1.3 参考资料

- [开发工作流程](../dev_workflow/README.md)
- [测试规范](../dev_workflow/TESTING.md)
- [部署指南](DEPLOYMENT_GUIDE.md)

---

## 2. 版本号规范

### 2.1 语义化版本

项目采用语义化版本规范（Semantic Versioning 2.0.0）：

- 格式：`MAJOR.MINOR.PATCH`（例如：1.2.3）
- MAJOR：不兼容的API变更
- MINOR：向下兼容的功能添加
- PATCH：向下兼容的问题修复

### 2.2 版本类型

- **开发版本**：`v1.2.3-dev.N`（开发中的版本）
- **预发布版本**：`v1.2.3-rc.N`（发布候选版本）
- **正式版本**：`v1.2.3`（稳定版本）
- **补丁版本**：`v1.2.4`（紧急修复版本）

---

## 3. 版本发布流程

### 3.1 预发布准备

1. **代码冻结**
   - 冻结主分支代码
   - 完成所有计划功能开发
   - 修复所有已知高优先级问题

2. **测试验证**
   - 完成所有单元测试
   - 执行集成测试
   - 进行系统测试
   - 进行用户验收测试

3. **文档更新**
   - 更新用户文档
   - 更新API文档
   - 更新部署文档
   - 更新版本发布说明

### 3.2 发布候选（RC）阶段

1. **创建发布候选版本**
   - 从主分支创建发布分支
   - 生成发布候选版本
   - 标记Git标签（如`v1.2.3-rc.1`）

2. **RC测试**
   - 内部测试团队验证
   - 关键用户试用
   - 性能和安全测试
   - 兼容性测试

3. **RC迭代**
   - 修复发现的问题
   - 生成新的RC版本
   - 重复测试直到稳定

### 3.3 正式发布

1. **最终验证**
   - 确认所有测试通过
   - 验证安装和升级流程
   - 确认回滚方案可用

2. **版本发布**
   - 创建正式版本标签（如`v1.2.3`）
   - 生成发布包
   - 更新文档
   - 发布到包管理器

3. **发布后验证**
   - 监控系统稳定性
   - 收集用户反馈
   - 跟踪性能指标

---

## 4. 分支管理策略

### 4.1 主要分支

- **main**：主开发分支，包含最新稳定代码
- **develop**：开发集成分支，包含下一个版本的开发代码
- **release/**：发布分支，用于准备发布版本
- **hotfix/**：紧急修复分支，用于紧急修复

### 4.2 分支命名规范

- 功能分支：`feature/功能名称`
- 修复分支：`fix/问题描述`
- 发布分支：`release/vX.Y.Z`
- 热修复分支：`hotfix/vX.Y.Z`

### 4.3 分支合并策略

- 所有功能开发在功能分支进行
- 通过Pull Request合并到主分支
- 代码审查通过后才能合并
- 自动化测试通过后才能合并

---

## 5. 版本标签规范

### 5.1 Git标签命名

- 正式版本：`v1.2.3`
- 预发布版本：`v1.2.3-rc.1`
- 开发版本：`v1.2.3-dev.1`

### 5.2 标签描述

每个标签应包含：

- 版本变更说明
- 重要更新内容
- 已知问题
- 升级注意事项

---

## 6. 版本维护

### 6.1 支持策略

- **当前版本**：完全支持，接收所有更新
- **上一版本**：有限支持，仅接收安全修复
- **更早版本**：不再支持

### 6.2 补丁策略

- 紧急安全问题：立即发布补丁
- 重要bug修复：定期发布补丁
- 功能更新：合并到下一版本

### 6.3 版本废弃

- 提前2个月通知废弃计划
- 提供迁移指南
- 在文档中明确标记

---

## 7. 自动化工具

### 7.1 版本管理脚本

```bash
#!/bin/bash
# version_manager.sh - 版本管理辅助脚本

# 获取当前版本
get_current_version() {
    # 从配置文件或环境变量获取当前版本
    cat VERSION 2>/dev/null || echo "v0.0.0"
}

# 递增版本号
increment_version() {
    local version=$1
    local type=$2
    local major minor patch

    # 解析版本号
    IFS='.' read -r major minor patch <<< "${version#v}"

    case $type in
        "major")
            major=$((major + 1))
            minor=0
            patch=0
            ;;
        "minor")
            minor=$((minor + 1))
            patch=0
            ;;
        "patch")
            patch=$((patch + 1))
            ;;
        *)
            echo "Usage: increment_version <version> <major|minor|patch>"
            return 1
            ;;
    esac

    echo "v$major.$minor.$patch"
}

# 创建版本标签
create_tag() {
    local version=$1
    local message=$2

    git tag -a "$version" -m "$message"
    echo "Created tag: $version"
}

# 使用示例
# NEW_VERSION=$(increment_version $(get_current_version) "minor")
# create_tag "$NEW_VERSION" "Release version $NEW_VERSION"
```

### 7.2 发布自动化

- 自动化构建流程
- 自动化测试执行
- 自动化文档生成
- 自动化包发布

---

## 8. 版本发布清单

### 8.1 发布前检查

- [ ] 所有测试用例通过
- [ ] 代码审查完成
- [ ] 文档更新完成
- [ ] 性能测试通过
- [ ] 安全扫描通过
- [ ] 兼容性验证完成
- [ ] 回滚方案准备就绪

### 8.2 发布后验证

- [ ] 服务正常启动
- [ ] 核心功能验证
- [ ] 性能指标正常
- [ ] 监控告警正常
- [ ] 用户反馈收集

---

## 9. 版本回滚策略

### 9.1 回滚准备

- 发布前备份当前版本
- 准备回滚脚本
- 验证回滚流程

### 9.2 回滚执行

- 紧急情况：立即回滚
- 一般情况：按计划回滚
- 验证回滚结果

---

## 10. 相关文档

- [开发工作流程](../dev_workflow/README.md) - 开发流程相关文档
- [测试规范](../dev_workflow/TESTING.md) - 测试执行规范
- [部署指南](DEPLOYMENT_GUIDE.md) - 部署相关文档

---

## 11. 最新更新记录

| 日期       | 版本   | 变更说明           |
| ---------- | ------ | ------------------ |
| 2025-01-26 | v1.0.0 | 初始化版本管理策略 |

---

## 修订历史

| 版本   | 日期       | 作者         | 变更说明         |
| ------ | ---------- | ------------ | ---------------- |
| v1.0.0 | 2025-01-26 | 项目开发团队 | 创建版本管理策略 |

---

最后更新: 2025-01-26
